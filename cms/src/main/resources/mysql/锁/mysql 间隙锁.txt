当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的 索引项加锁；
对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP)”，InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁 （Next-Key锁）

不使用范围条件，使用相等条件，取间隙锁取的是相等条件前一条记录，相等条件后一条，及其间隙也都会上锁


https://www.cnblogs.com/crazylqy/p/7821481.html

innodb自动使用间隙锁的条件：
（1）必须在RR级别下(可重复读)
（2）检索条件必须有索引（没有索引的话，mysql会全表扫描，那样会锁定整张表所有的记录，包括不存在的记录，此时其他事务不能修改不能删除不能添加）

间隙锁的目的是为了防止幻读，其主要通过两个方面实现这个目的：
（1）是为了防止同一事务的两次当前读，出现幻读的情况。(快照读不会加间隙锁)
（2）防止已存在的数据，更新成间隙内的数据（例如防止numer=3的记录通过update变成number=5）


mysql 如果设置事物隔离级别为未提交读，提交读的话，是不会产生间隙锁的，如果事物隔离级别为可重复读（默认隔离级别），则会产生间隙锁