基本思想就是，发送者，使用本地事务，加上发送消息，发送者本地事务提交成功，要确保消息发送是成功的，发送者本地事务回滚不发送消息

消费者要确保消息一定被消费，确保最终一致性

发送者这边要确保消息100%发送成功，大致方案就是消息提前入库，或者redis，并将消息设置为发送中，对于rabbitmq，使用发送者确认，失败通知，

如果消息发送成功就设置数据库中的消息状态为成功，如果失败，使用定时任务，拉取失败的消息进行重发。消费者这边确保消息100%消费，

对于rabbitmq，使用消费者确认，如果消费失败，则拒绝消息，并允许消息重新入队列，但要处理消息重复消息的问题